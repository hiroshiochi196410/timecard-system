function doGet(e) {
  try {
    // スプレッドシートを開く
    const ss = SpreadsheetApp.openById('19fdY39GIHSsGXaXmLCUOFn4nJI3GM-sZFFylZ8_YN4s');
    let sheet = ss.getSheetByName('タイムカード');
    
    // シートがなければ作成
    if (!sheet) {
      sheet = ss.insertSheet('タイムカード');
      sheet.appendRow(['タイムスタンプ', '社員番号', '氏名', '部署', '日付', '時刻', '種別', 'デバイスID']);
      sheet.getRange(1, 1, 1, 8).setFontWeight('bold').setBackground('#4285f4').setFontColor('white');
    }
    
    // 種別の日本語変換
    const typeNames = {
      'checkin': '出勤',
      'checkout': '退勤',
      'out': '外出',
      'return': '戻り'
    };
    
    // データを追加
    sheet.appendRow([
      new Date(),
      e.parameter.employeeNumber || '',
      e.parameter.employeeName || '',
      e.parameter.department || '',
      e.parameter.date || '',
      e.parameter.time || '',
      typeNames[e.parameter.type] || e.parameter.type || '',
      e.parameter.deviceId || ''
    ]);
    
    // 成功レスポンス
    return ContentService.createTextOutput(JSON.stringify({
      success: true,
      message: 'データを保存しました'
    })).setMimeType(ContentService.MimeType.JSON);
    
  } catch(err) {
    // エラーレスポンス
    return ContentService.createTextOutput(JSON.stringify({
      success: false,
      error: err.message
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    
    const ss = SpreadsheetApp.openById('19fdY39GIHSsGXaXmLCUOFn4nJI3GM-sZFFylZ8_YN4s');
    let sheet = ss.getSheetByName('タイムカード');
    
    if (!sheet) {
      sheet = ss.insertSheet('タイムカード');
      sheet.appendRow(['タイムスタンプ', '社員番号', '氏名', '部署', '日付', '時刻', '種別', 'デバイスID']);
    }
    
    const typeNames = {
      'checkin': '出勤',
      'checkout': '退勤',
      'out': '外出',
      'return': '戻り'
    };
    
    sheet.appendRow([
      new Date(),
      data.employeeNumber || '',
      data.employeeName || '',
      data.department || '',
      data.date || '',
      data.time || '',
      typeNames[data.type] || data.type || '',
      data.deviceId || ''
    ]);
    
    return ContentService.createTextOutput(JSON.stringify({
      success: true
    })).setMimeType(ContentService.MimeType.JSON);
    
  } catch(err) {
    return ContentService.createTextOutput(JSON.stringify({
      success: false,
      error: err.message
    })).setMimeType(ContentService.MimeType.JSON);
  }
}
