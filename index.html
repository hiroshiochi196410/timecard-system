<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - çµ±åˆç‰ˆï¼ˆåŒè‘‰ä¸‰å…±æ ªå¼ä¼šç¤¾ï¼‰</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        .instruction-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .early-shift { background: #fef5e7; color: #d68910; }
        .late-shift { background: #ebf8ff; color: #3182ce; }
        .normal-shift { background: #f0fff4; color: #38a169; }
    </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
const Clock = () => <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
const Users = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>;
const CheckCircle = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
const XCircle = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
const Edit = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>;
const Trash2 = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>;
const Download = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>;

const TimeCardApp = () => {
    // LocalStorageèª­ã¿è¾¼ã¿
    const loadFromLocalStorage = (key, defaultValue) => {
        try {
            const saved = localStorage.getItem(key);
            return saved ? JSON.parse(saved) : defaultValue;
        } catch (e) {
            console.error('LocalStorageèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            return defaultValue;
        }
    };

    // çŠ¶æ…‹ç®¡ç†
    const [employees, setEmployees] = useState(() => 
        loadFromLocalStorage('timecard_employees_v2', [
            { 
                id: 1, 
                name: 'å±±ç”°å¤ªéƒ', 
                employeeNumber: 'E001',
                employmentType: 'regular',
                role: 'employee', // employee, supervisor, manager
                annualLeave: 10
            },
            { 
                id: 2, 
                name: 'ä½è—¤ä¸Šå¸', 
                employeeNumber: 'E002',
                employmentType: 'regular',
                role: 'supervisor',
                annualLeave: 10
            },
            { 
                id: 3, 
                name: 'éˆ´æœ¨ç®¡ç†è€…', 
                employeeNumber: 'E003',
                employmentType: 'manager',
                role: 'manager',
                annualLeave: 10
            }
        ])
    );

    const [records, setRecords] = useState(() => 
        loadFromLocalStorage('timecard_records_v2', [])
    );

    const [selectedEmployeeId, setSelectedEmployeeId] = useState(1);
    const [currentDate, setCurrentDate] = useState(new Date().toISOString().split('T')[0]);
    const [startTime, setStartTime] = useState('08:00');
    const [endTime, setEndTime] = useState('17:00');
    const [breakTime, setBreakTime] = useState('100');
    const [isEarlyShift, setIsEarlyShift] = useState(false);
    const [isLateShift, setIsLateShift] = useState(false);
    const [instructedStartTime, setInstructedStartTime] = useState('');
    const [viewMode, setViewMode] = useState('input'); // input, approval, list

    // LocalStorageã¸ä¿å­˜
    useEffect(() => {
        localStorage.setItem('timecard_employees_v2', JSON.stringify(employees));
    }, [employees]);

    useEffect(() => {
        localStorage.setItem('timecard_records_v2', JSON.stringify(records));
    }, [records]);

    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
    const addMinutes = (timeStr, minutes) => {
        const [hours, mins] = timeStr.split(':').map(Number);
        const totalMins = hours * 60 + mins + minutes;
        const newHours = Math.floor(totalMins / 60) % 24;
        const newMins = totalMins % 60;
        return `${String(newHours).padStart(2, '0')}:${String(newMins).padStart(2, '0')}`;
    };

    const diffMinutes = (start, end) => {
        const [sh, sm] = start.split(':').map(Number);
        const [eh, em] = end.split(':').map(Number);
        return (eh * 60 + em) - (sh * 60 + sm);
    };

    const getShiftType = (instructedStart) => {
        if (!instructedStart) return 'é€šå¸¸';
        if (instructedStart < '08:00') return 'æ—©å‡º';
        if (instructedStart > '08:00') return 'é…å‡º';
        return 'é€šå¸¸';
    };

    // å¥‘ç´„æ™‚é–“ã‚’è¨ˆç®—ï¼ˆæ—©å‡ºãƒ»é…å‡ºã‚¹ãƒ©ã‚¤ãƒ‰å¯¾å¿œï¼‰
    const calculateContractTime = (record) => {
        const standardStart = '08:00';
        const standardEnd = '17:00';
        
        // æŒ‡ç¤ºå§‹æ¥­æ™‚åˆ»ãŒã‚ã‚‹å ´åˆã¯ã‚¹ãƒ©ã‚¤ãƒ‰
        if (record.instructedStartTime) {
            const workMinutes = 7 * 60; // å®Ÿåƒ7æ™‚é–“
            const totalMinutes = workMinutes + parseInt(record.breakTime || 100);
            const contractEnd = addMinutes(record.instructedStartTime, totalMinutes);
            
            return {
                start: record.instructedStartTime,
                end: contractEnd
            };
        }
        
        // æŒ‡ç¤ºãªã—ã¯æ¨™æº–æ™‚é–“
        return {
            start: standardStart,
            end: standardEnd
        };
    };

    // æ®‹æ¥­è¨ˆç®—ï¼ˆæ–°ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
    const calculateOvertimeHours = (record) => {
        const employee = employees.find(e => e.id === record.employeeId);
        
        // ç®¡ç†è·ã¯æ®‹æ¥­ãªã—
        if (employee?.employmentType === 'manager') {
            return 0;
        }

        if (!record.startTime || !record.endTime) {
            return 0;
        }

        // å¥‘ç´„æ™‚é–“ã‚’å–å¾—
        const contract = calculateContractTime(record);
        
        // å®Ÿéš›ã®å‹¤å‹™é–‹å§‹æ™‚åˆ»ã¯å¥‘ç´„é–‹å§‹æ™‚åˆ»ã‚ˆã‚Šæ—©ãã¦ã‚‚å¥‘ç´„é–‹å§‹ã‹ã‚‰è¨ˆç®—
        const actualStart = record.startTime < contract.start ? contract.start : record.startTime;
        
        // å‹¤å‹™çµ‚äº†ãŒå¥‘ç´„çµ‚äº†ã‚ˆã‚Šé…ã„å ´åˆã®ã¿æ®‹æ¥­
        if (record.endTime <= contract.end) {
            return 0;
        }
        
        // æ®‹æ¥­æ™‚é–“ã‚’è¨ˆç®—
        const overtimeMinutes = diffMinutes(contract.end, record.endTime);
        return overtimeMinutes / 60;
    };

    // å‹¤æ€ è¨˜éŒ²è¿½åŠ 
    const addRecord = () => {
        if (!startTime || !endTime) {
            alert('âŒ å‡ºå‹¤æ™‚åˆ»ãƒ»é€€å‹¤æ™‚åˆ»ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
        }

        // æ—©å‡ºãƒ»é…å‡ºæŒ‡ç¤ºãŒã‚ã‚‹å ´åˆã¯æŒ‡ç¤ºæ™‚åˆ»ã‚’è¨˜éŒ²
        let instructedTime = '';
        if (isEarlyShift || isLateShift) {
            instructedTime = instructedStartTime || startTime;
        }

        const newRecord = {
            id: Date.now(),
            employeeId: selectedEmployeeId,
            date: currentDate,
            startTime,
            endTime,
            breakTime: parseInt(breakTime),
            instructedStartTime: instructedTime, // æŒ‡ç¤ºå§‹æ¥­æ™‚åˆ»
            supervisorApproved: false, // ä¸Šå¸æ‰¿èª
            managerApproved: false, // ç®¡ç†è€…æ‰¿èª
            isEarlyShift,
            isLateShift
        };

        // æ®‹æ¥­æ™‚é–“ã‚’è¨ˆç®—
        newRecord.overtimeHours = calculateOvertimeHours(newRecord);

        setRecords([...records, newRecord].sort((a, b) => 
            new Date(b.date) - new Date(a.date)
        ));

        const employee = employees.find(e => e.id === selectedEmployeeId);
        alert(`âœ… ${employee?.name}ã•ã‚“ã®${currentDate}ã®å‹¤æ€ è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼`);

        // ãƒªã‚»ãƒƒãƒˆ
        setCurrentDate(new Date().toISOString().split('T')[0]);
        setStartTime('08:00');
        setEndTime('17:00');
        setBreakTime('100');
        setIsEarlyShift(false);
        setIsLateShift(false);
        setInstructedStartTime('');
    };

    // æ‰¿èªå‡¦ç†
    const handleSupervisorApprove = (recordId) => {
        const updated = records.map(r =>
            r.id === recordId ? { ...r, supervisorApproved: true } : r
        );
        setRecords(updated);
    };

    const handleManagerApprove = (recordId) => {
        const updated = records.map(r =>
            r.id === recordId ? { ...r, managerApproved: true } : r
        );
        setRecords(updated);
    };

    const handleReject = (recordId, level) => {
        const updated = records.map(r => {
            if (r.id === recordId) {
                if (level === 'supervisor') {
                    return { ...r, supervisorApproved: false };
                } else if (level === 'manager') {
                    return { ...r, managerApproved: false, supervisorApproved: false };
                }
            }
            return r;
        });
        setRecords(updated);
    };

    // ãƒ¬ã‚³ãƒ¼ãƒ‰å‰Šé™¤
    const deleteRecord = (id) => {
        if (confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
            setRecords(records.filter(r => r.id !== id));
        }
    };

    // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    const exportToCSV = () => {
        if (records.length === 0) {
            alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
            return;
        }

        const headers = ['å¾“æ¥­å“¡å', 'æ—¥ä»˜', 'å‡ºå‹¤', 'é€€å‹¤', 'ä¼‘æ†©(åˆ†)', 'å‹¤å‹™åŒºåˆ†', 'æŒ‡ç¤ºå§‹æ¥­', 'å¥‘ç´„çµ‚æ¥­', 'æ®‹æ¥­(h)', 'ä¸Šå¸æ‰¿èª', 'ç®¡ç†è€…æ‰¿èª'];
        
        const rows = records.map(record => {
            const employee = employees.find(e => e.id === record.employeeId);
            const contract = calculateContractTime(record);
            const shiftType = getShiftType(record.instructedStartTime);
            
            return [
                employee?.name || '',
                record.date,
                record.startTime,
                record.endTime,
                record.breakTime,
                shiftType,
                record.instructedStartTime || '-',
                contract.end,
                record.overtimeHours.toFixed(2),
                record.supervisorApproved ? 'âœ“' : '-',
                record.managerApproved ? 'âœ“' : '-'
            ];
        });

        const csvContent = [headers, ...rows]
            .map(row => row.map(cell => `"${cell}"`).join(','))
            .join('\n');

        const bom = '\uFEFF';
        const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `å‹¤æ€ è¨˜éŒ²_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
    };

    const employee = employees.find(e => e.id === selectedEmployeeId);
    const employeeRecords = records.filter(r => r.employeeId === selectedEmployeeId);

    // æ‰¿èªå¾…ã¡ãƒ¬ã‚³ãƒ¼ãƒ‰
    const pendingRecords = records.filter(r => {
        const otHours = calculateOvertimeHours(r);
        if (otHours === 0) return false;
        
        if (viewMode === 'approval') {
            return !r.supervisorApproved || !r.managerApproved;
        }
        return false;
    });

    return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="max-w-7xl mx-auto mb-6">
                <div className="bg-white rounded-2xl shadow-xl p-6">
                    <div className="flex items-center gap-3">
                        <Clock />
                        <div>
                            <h1 className="text-3xl font-bold text-gray-800">
                                ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆçµ±åˆç‰ˆï¼‰
                            </h1>
                            <p className="text-sm text-gray-600">
                                åŒè‘‰ä¸‰å…±æ ªå¼ä¼šç¤¾ - æ—©å‡ºãƒ»é…å‡ºã‚¹ãƒ©ã‚¤ãƒ‰åˆ¶ / 2æ®µéšæ‰¿èªå¯¾å¿œ
                            </p>
                        </div>
                    </div>

                    {/* ã‚¿ãƒ– */}
                    <div className="flex gap-2 mt-4">
                        <button
                            onClick={() => setViewMode('input')}
                            className={`px-4 py-2 rounded-lg font-semibold ${
                                viewMode === 'input'
                                    ? 'bg-indigo-600 text-white'
                                    : 'bg-gray-200 text-gray-700'
                            }`}
                        >
                            å‹¤æ€ å…¥åŠ›
                        </button>
                        <button
                            onClick={() => setViewMode('approval')}
                            className={`px-4 py-2 rounded-lg font-semibold ${
                                viewMode === 'approval'
                                    ? 'bg-indigo-600 text-white'
                                    : 'bg-gray-200 text-gray-700'
                            }`}
                        >
                            æ‰¿èªç®¡ç†
                        </button>
                        <button
                            onClick={() => setViewMode('list')}
                            className={`px-4 py-2 rounded-lg font-semibold ${
                                viewMode === 'list'
                                    ? 'bg-indigo-600 text-white'
                                    : 'bg-gray-200 text-gray-700'
                            }`}
                        >
                            è¨˜éŒ²ä¸€è¦§
                        </button>
                    </div>
                </div>
            </div>

            {/* å‹¤æ€ å…¥åŠ›ç”»é¢ */}
            {viewMode === 'input' && (
                <div className="max-w-7xl mx-auto grid gap-6 lg:grid-cols-2">
                    {/* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */}
                    <div className="bg-white rounded-xl shadow-xl p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <Users />
                            å‹¤æ€ è¨˜éŒ²å…¥åŠ›
                        </h2>

                        {/* å¾“æ¥­å“¡é¸æŠ */}
                        <div className="mb-4">
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                å¾“æ¥­å“¡
                            </label>
                            <select
                                value={selectedEmployeeId}
                                onChange={(e) => setSelectedEmployeeId(parseInt(e.target.value))}
                                className="w-full px-3 py-2 border border-gray-300 rounded"
                            >
                                {employees.map(emp => (
                                    <option key={emp.id} value={emp.id}>
                                        {emp.name} ({emp.employeeNumber})
                                    </option>
                                ))}
                            </select>
                        </div>

                        {/* æ—¥ä»˜ */}
                        <div className="mb-4">
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                æ—¥ä»˜
                            </label>
                            <input
                                type="date"
                                value={currentDate}
                                onChange={(e) => setCurrentDate(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded"
                            />
                        </div>

                        {/* æ—©å‡ºãƒ»é…å‡ºæŒ‡ç¤º */}
                        <div className="mb-4 p-4 bg-amber-50 border-2 border-amber-200 rounded-lg">
                            <label className="block text-sm font-semibold text-amber-900 mb-2">
                                ğŸ“ å‹¤å‹™æŒ‡ç¤º
                            </label>
                            <div className="flex gap-4 mb-3">
                                <label className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={isEarlyShift}
                                        onChange={(e) => {
                                            setIsEarlyShift(e.target.checked);
                                            if (e.target.checked) setIsLateShift(false);
                                        }}
                                    />
                                    <span className="text-sm font-medium">æ—©å‡ºæŒ‡ç¤º</span>
                                </label>
                                <label className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={isLateShift}
                                        onChange={(e) => {
                                            setIsLateShift(e.target.checked);
                                            if (e.target.checked) setIsEarlyShift(false);
                                        }}
                                    />
                                    <span className="text-sm font-medium">é…å‡ºæŒ‡ç¤º</span>
                                </label>
                            </div>
                            
                            {(isEarlyShift || isLateShift) && (
                                <div>
                                    <label className="block text-xs font-medium text-gray-700 mb-1">
                                        æŒ‡å®šå§‹æ¥­æ™‚åˆ» âš¡
                                    </label>
                                    <input
                                        type="time"
                                        value={instructedStartTime || startTime}
                                        onChange={(e) => {
                                            setInstructedStartTime(e.target.value);
                                            setStartTime(e.target.value);
                                        }}
                                        className="w-full px-3 py-2 border-2 border-amber-300 rounded"
                                    />
                                    <p className="text-xs text-gray-600 mt-1">
                                        âš ï¸ å¥‘ç´„æ™‚é–“å…¨ä½“ãŒã‚¹ãƒ©ã‚¤ãƒ‰ã—ã¾ã™ï¼ˆå®Ÿåƒ7h + ä¼‘æ†©{breakTime}åˆ†ï¼‰
                                    </p>
                                    <p className="text-xs font-semibold text-amber-700 mt-1">
                                        â†’ å¥‘ç´„çµ‚æ¥­: {addMinutes(instructedStartTime || startTime, 7 * 60 + parseInt(breakTime))}
                                    </p>
                                </div>
                            )}
                        </div>

                        {/* å‡ºå‹¤ãƒ»é€€å‹¤æ™‚åˆ» */}
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    å‡ºå‹¤æ™‚åˆ»
                                </label>
                                <input
                                    type="time"
                                    value={startTime}
                                    onChange={(e) => setStartTime(e.target.value)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    é€€å‹¤æ™‚åˆ»
                                </label>
                                <input
                                    type="time"
                                    value={endTime}
                                    onChange={(e) => setEndTime(e.target.value)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded"
                                />
                            </div>
                        </div>

                        {/* ä¼‘æ†©æ™‚é–“ */}
                        <div className="mb-6">
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                ä¼‘æ†©æ™‚é–“ï¼ˆåˆ†ï¼‰
                            </label>
                            <input
                                type="number"
                                value={breakTime}
                                onChange={(e) => setBreakTime(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded"
                            />
                        </div>

                        <button
                            onClick={addRecord}
                            className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700"
                        >
                            è¨˜éŒ²ã‚’è¿½åŠ 
                        </button>
                    </div>

                    {/* çµ±è¨ˆæƒ…å ± */}
                    <div className="bg-white rounded-xl shadow-xl p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4">
                            {employee?.name}ã•ã‚“ã®çµ±è¨ˆ
                        </h2>

                        <div className="space-y-3">
                            <div className="p-4 bg-blue-50 rounded-lg">
                                <div className="text-sm text-gray-600">å‹¤å‹™æ—¥æ•°</div>
                                <div className="text-2xl font-bold text-blue-700">
                                    {employeeRecords.length}æ—¥
                                </div>
                            </div>
                            
                            <div className="p-4 bg-green-50 rounded-lg">
                                <div className="text-sm text-gray-600">æ‰¿èªæ¸ˆæ®‹æ¥­</div>
                                <div className="text-2xl font-bold text-green-700">
                                    {employeeRecords
                                        .filter(r => r.supervisorApproved && r.managerApproved)
                                        .reduce((sum, r) => sum + (r.overtimeHours || 0), 0)
                                        .toFixed(1)}h
                                </div>
                            </div>
                            
                            <div className="p-4 bg-amber-50 rounded-lg">
                                <div className="text-sm text-gray-600">æ‰¿èªå¾…ã¡æ®‹æ¥­</div>
                                <div className="text-2xl font-bold text-amber-700">
                                    {employeeRecords
                                        .filter(r => (r.overtimeHours || 0) > 0 && (!r.supervisorApproved || !r.managerApproved))
                                        .reduce((sum, r) => sum + (r.overtimeHours || 0), 0)
                                        .toFixed(1)}h
                                </div>
                            </div>
                        </div>

                        <button
                            onClick={exportToCSV}
                            className="w-full mt-6 bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 flex items-center justify-center gap-2"
                        >
                            <Download />
                            CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                        </button>
                    </div>
                </div>
            )}

            {/* æ‰¿èªç®¡ç†ç”»é¢ */}
            {viewMode === 'approval' && (
                <div className="max-w-7xl mx-auto">
                    <div className="bg-white rounded-xl shadow-xl p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <CheckCircle />
                            æ®‹æ¥­æ‰¿èªç®¡ç†ï¼ˆ2æ®µéšæ‰¿èªï¼‰
                        </h2>

                        {pendingRecords.length === 0 ? (
                            <div className="text-center py-12 text-gray-500">
                                æ‰¿èªå¾…ã¡ã®è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {pendingRecords.map(record => {
                                    const emp = employees.find(e => e.id === record.employeeId);
                                    const contract = calculateContractTime(record);
                                    const shiftType = getShiftType(record.instructedStartTime);
                                    const otHours = calculateOvertimeHours(record);

                                    return (
                                        <div key={record.id} className="border-2 border-gray-200 rounded-lg p-4">
                                            <div className="flex justify-between items-start mb-3">
                                                <div>
                                                    <div className="font-bold text-lg">{emp?.name}</div>
                                                    <div className="text-sm text-gray-600">{record.date}</div>
                                                </div>
                                                <span className={`instruction-badge ${
                                                    shiftType === 'æ—©å‡º' ? 'early-shift' :
                                                    shiftType === 'é…å‡º' ? 'late-shift' : 'normal-shift'
                                                }`}>
                                                    {shiftType}
                                                </span>
                                            </div>

                                            <div className="grid grid-cols-2 gap-4 mb-3 text-sm">
                                                <div>
                                                    <div className="text-gray-600">å¥‘ç´„æ™‚é–“</div>
                                                    <div className="font-semibold">{contract.start} - {contract.end}</div>
                                                </div>
                                                <div>
                                                    <div className="text-gray-600">å®Ÿç¸¾æ™‚é–“</div>
                                                    <div className="font-semibold">{record.startTime} - {record.endTime}</div>
                                                </div>
                                            </div>

                                            <div className="p-3 bg-orange-50 border-l-4 border-orange-500 mb-3">
                                                <div className="text-sm text-gray-600">æ®‹æ¥­æ™‚é–“</div>
                                                <div className="text-2xl font-bold text-orange-700">
                                                    {otHours.toFixed(2)}æ™‚é–“
                                                </div>
                                            </div>

                                            {/* 2æ®µéšæ‰¿èªãƒœã‚¿ãƒ³ */}
                                            <div className="flex gap-2">
                                                {!record.supervisorApproved && (
                                                    <>
                                                        <button
                                                            onClick={() => handleSupervisorApprove(record.id)}
                                                            className="flex-1 px-4 py-2 bg-blue-600 text-white rounded font-semibold hover:bg-blue-700"
                                                        >
                                                            âœ“ ä¸Šå¸æ‰¿èª
                                                        </button>
                                                        <button
                                                            onClick={() => handleReject(record.id, 'supervisor')}
                                                            className="px-4 py-2 bg-red-600 text-white rounded font-semibold hover:bg-red-700"
                                                        >
                                                            âœ— å´ä¸‹
                                                        </button>
                                                    </>
                                                )}
                                                
                                                {record.supervisorApproved && !record.managerApproved && (
                                                    <>
                                                        <span className="px-4 py-2 bg-blue-100 text-blue-700 rounded font-semibold flex items-center gap-1">
                                                            âœ“ ä¸Šå¸æ‰¿èªæ¸ˆ
                                                        </span>
                                                        <button
                                                            onClick={() => handleManagerApprove(record.id)}
                                                            className="flex-1 px-4 py-2 bg-green-600 text-white rounded font-semibold hover:bg-green-700"
                                                        >
                                                            âœ“ ç®¡ç†è€…æ‰¿èª
                                                        </button>
                                                        <button
                                                            onClick={() => handleReject(record.id, 'manager')}
                                                            className="px-4 py-2 bg-red-600 text-white rounded font-semibold hover:bg-red-700"
                                                        >
                                                            âœ— å´ä¸‹
                                                        </button>
                                                    </>
                                                )}
                                                
                                                {record.supervisorApproved && record.managerApproved && (
                                                    <span className="w-full px-4 py-2 bg-green-100 text-green-700 rounded font-semibold text-center">
                                                        âœ“âœ“ å®Œå…¨æ‰¿èªæ¸ˆï¼ˆçµ¦ä¸åæ˜ ï¼‰
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>
                </div>
            )}

            {/* è¨˜éŒ²ä¸€è¦§ç”»é¢ */}
            {viewMode === 'list' && (
                <div className="max-w-7xl mx-auto">
                    <div className="bg-white rounded-xl shadow-xl p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4">
                            å…¨è¨˜éŒ²ä¸€è¦§
                        </h2>

                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-100">
                                    <tr>
                                        <th className="px-4 py-2 text-left">å¾“æ¥­å“¡</th>
                                        <th className="px-4 py-2 text-left">æ—¥ä»˜</th>
                                        <th className="px-4 py-2 text-left">åŒºåˆ†</th>
                                        <th className="px-4 py-2 text-left">å¥‘ç´„æ™‚é–“</th>
                                        <th className="px-4 py-2 text-left">å®Ÿç¸¾æ™‚é–“</th>
                                        <th className="px-4 py-2 text-left">æ®‹æ¥­</th>
                                        <th className="px-4 py-2 text-left">æ‰¿èª</th>
                                        <th className="px-4 py-2"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {records.map(record => {
                                        const emp = employees.find(e => e.id === record.employeeId);
                                        const contract = calculateContractTime(record);
                                        const shiftType = getShiftType(record.instructedStartTime);
                                        const otHours = calculateOvertimeHours(record);

                                        return (
                                            <tr key={record.id} className="border-t hover:bg-gray-50">
                                                <td className="px-4 py-3">{emp?.name}</td>
                                                <td className="px-4 py-3">{record.date}</td>
                                                <td className="px-4 py-3">
                                                    <span className={`instruction-badge ${
                                                        shiftType === 'æ—©å‡º' ? 'early-shift' :
                                                        shiftType === 'é…å‡º' ? 'late-shift' : 'normal-shift'
                                                    }`}>
                                                        {shiftType}
                                                    </span>
                                                </td>
                                                <td className="px-4 py-3 text-sm">
                                                    {contract.start} - {contract.end}
                                                </td>
                                                <td className="px-4 py-3 text-sm">
                                                    {record.startTime} - {record.endTime}
                                                </td>
                                                <td className="px-4 py-3 font-semibold">
                                                    {otHours > 0 ? `${otHours.toFixed(2)}h` : '-'}
                                                </td>
                                                <td className="px-4 py-3 text-xs">
                                                    {record.supervisorApproved && record.managerApproved ? (
                                                        <span className="text-green-600 font-semibold">âœ“âœ“ å®Œå…¨æ‰¿èª</span>
                                                    ) : record.supervisorApproved ? (
                                                        <span className="text-blue-600 font-semibold">âœ“ ä¸Šå¸æ‰¿èª</span>
                                                    ) : otHours > 0 ? (
                                                        <span className="text-gray-500">æœªæ‰¿èª</span>
                                                    ) : (
                                                        <span className="text-gray-400">-</span>
                                                    )}
                                                </td>
                                                <td className="px-4 py-3">
                                                    <button
                                                        onClick={() => deleteRecord(record.id)}
                                                        className="text-red-600 hover:text-red-800"
                                                    >
                                                        <Trash2 />
                                                    </button>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};

ReactDOM.render(<TimeCardApp />, document.getElementById('root'));
</script>
</body>
</html>
